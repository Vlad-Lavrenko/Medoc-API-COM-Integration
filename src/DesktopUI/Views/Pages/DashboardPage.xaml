<UserControl x:Class="MedocIntegration.DesktopUI.Views.Pages.DashboardPage"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
             xmlns:converters="clr-namespace:MedocIntegration.DesktopUI.Converters">

    <UserControl.Resources>
        <converters:LogLevelToColorConverter x:Key="LogLevelToColorConverter"/>
    </UserControl.Resources>

    <Grid Margin="16">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <!-- Статус служби -->
            <RowDefinition Height="12"/>
            <RowDefinition Height="Auto"/>
            <!-- Кнопки керування -->
            <RowDefinition Height="12"/>
            <RowDefinition Height="Auto"/>
            <!-- Кнопка Scalar -->
            <RowDefinition Height="16"/>
            <RowDefinition Height="*"/>
            <!-- Логи -->
        </Grid.RowDefinitions>

        <!-- ═══════════════════════════════════════ -->
        <!-- БЛОК 1: Статус служби                  -->
        <!-- ═══════════════════════════════════════ -->
        <materialDesign:Card Grid.Row="0" Padding="20">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Іконка служби -->
                <materialDesign:PackIcon Grid.Column="0"
                                        Kind="ServerNetwork"
                                        Width="48" Height="48"
                                        VerticalAlignment="Center"
                                        Foreground="{DynamicResource MaterialDesign.Brush.Primary}"
                                        Margin="0,0,20,0"/>

                <!-- Назва та статус -->
                <StackPanel Grid.Column="1" VerticalAlignment="Center">
                    <TextBlock Text="Medoc Integration Service"
                              Style="{StaticResource MaterialDesignHeadline5TextBlock}"/>
                    <TextBlock Text="{Binding CurrentStatus.DisplayStatus}"
                              Style="{StaticResource MaterialDesignBody1TextBlock}"
                              Margin="0,6,0,0"/>
                </StackPanel>

                <!-- Індикатор статусу (кольоровий кружок) -->
                <Border Grid.Column="2"
                       Background="{Binding StatusColor}"
                       CornerRadius="24"
                       Width="48" Height="48"
                       VerticalAlignment="Center">
                    <materialDesign:PackIcon Kind="{Binding StatusIcon}"
                                            Width="28" Height="28"
                                            Foreground="White"
                                            HorizontalAlignment="Center"
                                            VerticalAlignment="Center"/>
                </Border>
            </Grid>
        </materialDesign:Card>

        <!-- ═══════════════════════════════════════ -->
        <!-- БЛОК 2: Кнопки керування службою       -->
        <!-- ═══════════════════════════════════════ -->
        <StackPanel Grid.Row="2" Orientation="Horizontal"
                   HorizontalAlignment="Center">

            <!-- Запустити -->
            <Button Style="{StaticResource MaterialDesignRaisedButton}"
                   Command="{Binding StartServiceCommand}"
                   IsEnabled="{Binding CurrentStatus.CanStart}"
                   Width="130" Height="42"
                   Margin="0,0,8,0"
                   ToolTip="Запустити службу">
                <StackPanel Orientation="Horizontal">
                    <materialDesign:PackIcon Kind="Play" Margin="0,0,8,0"/>
                    <TextBlock Text="Запустити"/>
                </StackPanel>
            </Button>

            <!-- Зупинити -->
            <Button Style="{StaticResource MaterialDesignRaisedButton}"
                   Command="{Binding StopServiceCommand}"
                   IsEnabled="{Binding CurrentStatus.CanStop}"
                   Width="130" Height="42"
                   Margin="0,0,8,0"
                   ToolTip="Зупинити службу">
                <StackPanel Orientation="Horizontal">
                    <materialDesign:PackIcon Kind="Stop" Margin="0,0,8,0"/>
                    <TextBlock Text="Зупинити"/>
                </StackPanel>
            </Button>

            <!-- Перезапустити -->
            <Button Style="{StaticResource MaterialDesignRaisedButton}"
                   Command="{Binding RestartServiceCommand}"
                   IsEnabled="{Binding CurrentStatus.CanStop}"
                   Width="150" Height="42"
                   Margin="0,0,8,0"
                   ToolTip="Перезапустити службу">
                <StackPanel Orientation="Horizontal">
                    <materialDesign:PackIcon Kind="Restart" Margin="0,0,8,0"/>
                    <TextBlock Text="Перезапустити"/>
                </StackPanel>
            </Button>

            <!-- Оновити статус -->
            <Button Style="{StaticResource MaterialDesignOutlinedButton}"
                   Command="{Binding RefreshStatusCommand}"
                   Width="130" Height="42"
                   ToolTip="Оновити статус служби">
                <StackPanel Orientation="Horizontal">
                    <materialDesign:PackIcon Kind="Refresh" Margin="0,0,8,0"/>
                    <TextBlock Text="Оновити"/>
                </StackPanel>
            </Button>
        </StackPanel>

        <!-- ═══════════════════════════════════════ -->
        <!-- БЛОК 3: Кнопка відкриття Scalar         -->
        <!-- ═══════════════════════════════════════ -->
        <Button Grid.Row="4"
               Style="{StaticResource MaterialDesignRaisedButton}"
               Command="{Binding OpenScalarCommand}"
               HorizontalAlignment="Center"
               Width="280" Height="46"
               ToolTip="Відкрити документацію API у браузері">
            <StackPanel Orientation="Horizontal">
                <materialDesign:PackIcon Kind="Web"
                                        Width="22" Height="22"
                                        Margin="0,0,10,0"
                                        VerticalAlignment="Center"/>
                <TextBlock Text="Відкрити Scalar API Documentation"
                          FontSize="13"
                          VerticalAlignment="Center"/>
            </StackPanel>
        </Button>

        <!-- ═══════════════════════════════════════ -->
        <!-- БЛОК 4: Логи                            -->
        <!-- ═══════════════════════════════════════ -->
        <materialDesign:Card Grid.Row="6" Padding="0">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <!-- Заголовок секції логів -->
                <Border Grid.Row="0"
                       Background="{DynamicResource MaterialDesign.Brush.Primary}"
                       Padding="16,10">
                    <Grid>
                        <TextBlock Text="Логи служби"
                                  Style="{StaticResource MaterialDesignSubtitle1TextBlock}"
                                  Foreground="White"
                                  VerticalAlignment="Center"/>

                        <StackPanel Orientation="Horizontal"
                                   HorizontalAlignment="Right">

                            <!-- Оновити логи -->
                            <Button Style="{StaticResource MaterialDesignFlatButton}"
                                   Command="{Binding RefreshLogsCommand}"
                                   Foreground="White"
                                   Height="32">
                                <StackPanel Orientation="Horizontal">
                                    <materialDesign:PackIcon Kind="Refresh"
                                                            Width="16" Height="16"
                                                            Margin="0,0,4,0"/>
                                    <TextBlock Text="Оновити"/>
                                </StackPanel>
                            </Button>

                            <!-- Очистити вигляд -->
                            <Button Style="{StaticResource MaterialDesignFlatButton}"
                                   Command="{Binding ClearLogsCommand}"
                                   Foreground="White"
                                   Height="32"
                                   Margin="4,0,0,0">
                                <StackPanel Orientation="Horizontal">
                                    <materialDesign:PackIcon Kind="EraserVariant"
                                                            Width="16" Height="16"
                                                            Margin="0,0,4,0"/>
                                    <TextBlock Text="Очистити"/>
                                </StackPanel>
                            </Button>
                        </StackPanel>
                    </Grid>
                </Border>

                <!-- DataGrid з логами -->
                <DataGrid Grid.Row="1"
                         ItemsSource="{Binding LogEntries}"
                         AutoGenerateColumns="False"
                         IsReadOnly="True"
                         CanUserAddRows="False"
                         CanUserDeleteRows="False"
                         CanUserResizeRows="False"
                         SelectionMode="Single"
                         FontFamily="Consolas"
                         FontSize="12"
                         materialDesign:DataGridAssist.CellPadding="6 4 6 4">

                    <DataGrid.Columns>
                        <!-- Час -->
                        <DataGridTextColumn Header="Час"
                                          Binding="{Binding Timestamp, StringFormat={}{0:HH:mm:ss.fff}}"
                                          Width="110"/>
                        <!-- Рівень -->
                        <DataGridTemplateColumn Header="Рівень" Width="72">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <Border Background="{Binding Level,
                                                Converter={StaticResource LogLevelToColorConverter}}"
                                           CornerRadius="4"
                                           Padding="6,2"
                                           HorizontalAlignment="Center">
                                        <TextBlock Text="{Binding Level}"
                                                  Foreground="White"
                                                  FontWeight="Bold"
                                                  HorizontalAlignment="Center"/>
                                    </Border>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>
                        <!-- Повідомлення -->
                        <DataGridTextColumn Header="Повідомлення"
                                          Binding="{Binding Message}"
                                          Width="*"/>
                    </DataGrid.Columns>
                </DataGrid>
            </Grid>
        </materialDesign:Card>

        <!-- Progress Bar (поверх всього при завантаженні) -->
        <ProgressBar Grid.Row="0" Grid.RowSpan="7"
                    Style="{StaticResource MaterialDesignLinearProgressBar}"
                    IsIndeterminate="True"
                    Visibility="{Binding IsLoading, Converter={StaticResource BoolToVisibility}}"
                    VerticalAlignment="Top"
                    Height="4"/>
    </Grid>
</UserControl>
